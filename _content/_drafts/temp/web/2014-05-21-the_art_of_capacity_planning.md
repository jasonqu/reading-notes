http://book.douban.com/subject/4200645/

### chap2 设定容量目标

* 性能
  对外服务监测
  业务需求
  用户期望
* 容量
  系统独立指标
  资源上限

观察服务监控系统时，要考虑：

* 它们在模拟人类吗？
* 会像一个真正的浏览器那样缓存数据吗
* 能确定网络传输耗费的时间吗
* 能确定是被或意外的等待是网络地理原因吗 

需要评估每一个程序的资源，然后合理分配。一般web服务器cpu密集，db是io密集

数据库每秒查询率的增长是如何影响一下配置的？

* 磁盘利用率
* io等待率（由于网络或磁盘运行导致的数据库等待时间的百分比）
* ram利用率
* cpu利用率

web服务每秒请求数的增加是如何影响以下配置的？

* 磁盘利用率
* io等待率
* ram利用率
* cpu利用率

### Chap3 测量

##### 一. 测量工具的功能 

* 随着时间记录和保存数据 
* 构建自定义度量指标
* 比较各种来源的度量指标
* 导入导出度量指标
* 常用工具:Cacti/Munin/Ganglia/Hyperic HQ
* 系统可用性、服务健康状况或通知管理，可以使用Nagios，Zenoss，OpenNMS等提供 


snmp协议

应用层测量，以Flickr为例 etc：

* 上传的照片（每日，每小时，积累）
* 平均照片大小
* 用户注册
* 标记图片数量
* API流量
* 地理标签数量

如有必要，还要加上财务指标，如总体拥有成本（TCO）

存储架构的测量标准：

* 读操作数
* 写操作数
* CPU用来等待读写的时间有多长


二. 进行容量规划的必要测量 

	a. 测量记录服务器的主要功能：apache请求、数据库查询 
	b. 测量记录服务器的基础硬件资源：CPU、内存、磁盘、网络 
	c. 判断服务器的主要功能如何与其硬件资源相关联：并发N个请求占%M的CPU，N%的内存 
	d. 通过压力测试，基于服务器的主要功能和硬件资源，找到可接受的最大资源使用量或者上限：线下模拟真实的生产负载（网络层引流） 


squid 反向代理缓存照片
vanish


#### 对瞬时增长的处理
##### 减轻失败

* 禁用重量级的功能：程序的特性开关、禁用日志等
* 烘烤过的静态页面：快、易缓存
* 缓存而不是过期
* 处理故障：成功的客户服务需要有效的共同交流